/* my_grep.c
   Basic grep simulation: my_grep <pattern> [file...]
   Compile: gcc -o my_grep my_grep.c
*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void search_file(const char *pattern, FILE *fp, const char *fname) {
    char line[1024];
    int lineno = 0;
    while (fgets(line, sizeof(line), fp)) {
        lineno++;
        if (strstr(line, pattern)) {
            if (fname) printf("%s:%d:%s", fname, lineno, line);
            else printf("%d:%s", lineno, line);
        }
    }
}

int main(int argc, char *argv[]) {
    if (argc < 2) { fprintf(stderr,"Usage: %s <pattern> [file...]\n", argv[0]); return 1; }
    const char *pattern = argv[1];

    if (argc == 2) {
        /* read from stdin */
        search_file(pattern, stdin, NULL);
    } else {
        for (int i=2;i<argc;i++) {
            FILE *f = fopen(argv[i], "r");
            if (!f) { perror(argv[i]); continue; }
            search_file(pattern, f, argv[i]);
            fclose(f);
        }
    }
    return 0;
}
