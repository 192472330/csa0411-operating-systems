/* thread_demo.c
   Demonstrates create, join, equal, exit in pthreads.
   Compile: gcc -o thread_demo thread_demo.c -pthread
*/
#include <stdio.h>
#include <pthread.h>
#include <unistd.h>

void *worker(void *arg) {
    int id = *(int*)arg;
    printf("Thread %d started (tid=%lu)\n", id, (unsigned long)pthread_self());
    sleep(1);
    if (id == 2) {
        printf("Thread %d calling pthread_exit\n", id);
        pthread_exit((void*)42);
    }
    return (void*)id;
}

int main() {
    pthread_t t1, t2;
    int id1 = 1, id2 = 2;
    pthread_create(&t1, NULL, worker, &id1);
    pthread_create(&t2, NULL, worker, &id2);

    /* compare threads */
    if (pthread_equal(t1, t2)) printf("t1 and t2 are equal (unexpected)\n");
    else printf("t1 and t2 are different (expected)\n");

    void *res1, *res2;
    pthread_join(t1, &res1);
    pthread_join(t2, &res2);
    printf("Joined t1 -> return %ld\n", (long)res1);
    printf("Joined t2 -> return %ld\n", (long)res2);

    return 0;
}
